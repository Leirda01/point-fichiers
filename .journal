#!/usr/bin/bash

if [[ $(date +%-H) -lt 3 ]]; then # -lt → less than
  date=$(date --date="yesterday" +%Y/%m/%d)
else
  date=$(date +%Y/%m/%d)
fi

mkdir -p "$HOME/saveuriendir/$date"

dir=$(ls "$HOME/saveuriendir/$date")
echo $dir

[[ $@ ]] && journal=$@ || journal="main"

if [[ $@ ]]; then
  journal=${@%%.md}
else
  if [[ $dir ]]; then
    select journal in $dir; do
      [[ $journal ]] && break;
    done
  else
    journal="main"
  fi
fi
    
[[ $journal = \n ]] && journal="main"
journal="$HOME/saveuriendir/$date/$journal.md"

[[ -O "$journal" ]] && chmod u+w "$journal" # -O → Own
vim "$journal"
[[ -w "$journal" ]] && chmod u-w "$journal" # -W → Write

[[ -s "$journal" ]] || rm -f "$journal" # -s → size ≠ 0
