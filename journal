#!/usr/bin/env bash

# echo Usage: $0 [COMMAND] [OPTION]... [FILE]

# journal FILE → open file for writing today

# journal write FILE → same as `journal FILE'

# journal grep PATTERN → search pattern in journal

# journal grep -d DATE... PATTERN → search pattern in specific date

# journal cp JOURNAL... → `cp' to xclipboard some § in journal

if [[ -z $(vim --version | grep +clientserver) ]]; then
  echo Error: Missing \`+clientserver\' option with vim.
  exit 1
fi

if [[ $(vim --serverlist | grep JOURNAL) ]]; then
  vim --servername JOURNAL --remote-send "<C-\><C-N>:xall:qall!"
fi

[[ $(date +%-H) -lt 4 ]] && date="yesterday" || date="today"
date=$(date --date=$date +%Y/%m/%d)

mkdir -p "$HOME/saveuriendir/$date"

journal=${@:-main}
path="$HOME/saveuriendir/$date/${journal%%.md}.md"

vim --servername JOURNAL "$path"

[[ -s "$path" ]] || rm -f "$path"
