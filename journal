#!/usr/bin/env bash

if [[ $(pgrep -f -o .config/journal) -ne $$ ]]; then
  echo Error script already running.
  exit 1
fi

[[ $(date +%-H) -lt 3 ]] && date="yesterday" || date="today"
date=$(date --date=$date +%Y/%m/%d)

mkdir -p "$HOME/saveuriendir/$date"
pushd "$HOME/saveuriendir/$date" > /dev/null

[[ $@ ]] && journal=$@ || journal="main"

journal="$HOME/saveuriendir/$date/${journal%%.md}.md"

[[ -O "$journal" ]] && chmod u+w "$journal"
vim "$journal"
[[ -w "$journal" ]] && chmod u-w "$journal"

[[ -s "$journal" ]] || rm -f "$journal"
